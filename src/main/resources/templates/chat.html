<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Azure OpenAI Bot</title>
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            background: #f7f7f8;
            display: flex;
            flex-direction: column;
        }

        .chat-container { flex: 1; display: flex; flex-direction: column; }
        .chat-box { flex: 1; padding: 15px; overflow-y: auto; }
        .chat-message { margin: 8px 0; display: flex; }
        .chat-message.user { justify-content: flex-end; }
        .chat-message.bot { justify-content: flex-start; }
        .chat-bubble { max-width: 70%; padding: 10px 15px; border-radius: 18px; line-height: 1.4; }
        .user .chat-bubble { background: #007bff; color: #fff; border-bottom-right-radius: 4px; }
        .bot .chat-bubble { background: #e4e6eb; color: #000; border-bottom-left-radius: 4px; }

        .chat-input { display: flex; padding: 10px; border-top: 1px solid #ddd; background: #fff; }
        .chat-input input { flex: 1; border-radius: 20px; border: 1px solid #ccc; padding: 10px 15px; outline: none; }
        .chat-input button { margin-left: 10px; border-radius: 20px; }

        /* Typing dots animation */
        .thinking-dots {
            display: flex;
            gap: 4px;
        }
        .thinking-dots span {
            width: 8px; height: 8px;
            background: #555; border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite;
        }
        .thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
        .thinking-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
<div class="chat-container">
    <div class="chat-box" id="chatBox">
        <div class="chat-message bot">
            <div class="chat-bubble">üëã Hi! I‚Äôm your Azure OpenAI Bot. Ask me anything!</div>
        </div>
    </div>
    <div class="chat-input">
        <input id="userInput" type="text" placeholder="Type your message..." 
               onkeypress="if(event.key==='Enter'){sendMessage();}"/>
        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    async function sendMessage() {
        const input = document.getElementById("userInput");
        const message = input.value.trim();
        if (!message) return;

        const chatBox = document.getElementById("chatBox");

        // Add user message
        chatBox.innerHTML += `
            <div class="chat-message user">
                <div class="chat-bubble">${message}</div>
            </div>`;
        input.value = "";

        // Add "thinking..." placeholder
        const thinkingId = "thinking-" + Date.now();
        chatBox.innerHTML += `
            <div class="chat-message bot" id="${thinkingId}">
                <div class="chat-bubble">
                    <div class="thinking-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            </div>`;
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
            const response = await fetch(`/api/ask?prompt=${encodeURIComponent(message)}`);
            const text = await response.text();

            // Remove thinking indicator
            document.getElementById(thinkingId).remove();

            // Add real bot reply
            chatBox.innerHTML += `
                <div class="chat-message bot">
                    <div class="chat-bubble">${text}</div>
                </div>`;
        } catch (e) {
            document.getElementById(thinkingId).remove();
            chatBox.innerHTML += `
                <div class="chat-message bot">
                    <div class="chat-bubble text-danger">‚ö†Ô∏è Error contacting backend</div>
                </div>`;
        }

        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
